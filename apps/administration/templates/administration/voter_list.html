{% extends 'administration/base_admin.html' %}

{% block content %}
<div class="admin-header">
    <h1 class="admin-title">Voters Management</h1>
    <div class="admin-actions">
        <div style="display: flex; gap: 1rem; align-items: center;">
            <input type="text" id="searchInput" placeholder="Search voters..."
                style="padding: 0.75rem 1rem; border: 1px solid #cbd5e1; border-radius: 8px; width: 300px;">
            <select id="filterCourse" style="padding: 0.75rem 1rem; border: 1px solid #cbd5e1; border-radius: 8px;">
                <option value="">All Courses</option>
                {% for course in courses %}
                <option value="{{ course }}">{{ course }}</option>
                {% endfor %}
            </select>
            <select id="filterYear" style="padding: 0.75rem 1rem; border: 1px solid #cbd5e1; border-radius: 8px;">
                <option value="">All Years</option>
                <option value="1">1st Year</option>
                <option value="2">2nd Year</option>
                <option value="3">3rd Year</option>
                <option value="4">4th Year</option>
            </select>
        </div>
    </div>
</div>

<div style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;">
    <div style="padding: 1.5rem; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3 style="font-size: 1rem; color: #64748b; margin-bottom: 0.25rem;">Total Registered Voters</h3>
                <p style="font-size: 2rem; font-weight: 700; color: #0f172a; margin: 0;">{{ voters.count }}</p>
            </div>
            <div style="text-align: right;">
                <h3 style="font-size: 1rem; color: #64748b; margin-bottom: 0.25rem;">Eligible to Vote</h3>
                <p style="font-size: 2rem; font-weight: 700; color: #10b981; margin: 0;">{{ eligible_count }}</p>
            </div>
        </div>
    </div>

    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                    <th style="padding: 1rem; text-align: left; font-weight: 600; color: #475569;">Student ID</th>
                    <th style="padding: 1rem; text-align: left; font-weight: 600; color: #475569;">Name</th>
                    <th style="padding: 1rem; text-align: left; font-weight: 600; color: #475569;">Email</th>
                    <th style="padding: 1rem; text-align: left; font-weight: 600; color: #475569;">Course</th>
                    <th style="padding: 1rem; text-align: left; font-weight: 600; color: #475569;">Year</th>
                    <th style="padding: 1rem; text-align: left; font-weight: 600; color: #475569;">Status</th>
                    <th style="padding: 1rem; text-align: left; font-weight: 600; color: #475569;">Votes Cast</th>
                </tr>
            </thead>
            <tbody id="votersTable">
                {% for voter in voters %}
                <tr class="voter-row" data-course="{{ voter.course }}" data-year="{{ voter.year_level }}"
                    style="border-bottom: 1px solid #e2e8f0; transition: background 0.2s;">
                    <td style="padding: 1rem; color: #0f172a; font-weight: 500;">{{ voter.student_id }}</td>
                    <td style="padding: 1rem; color: #0f172a;">{{ voter.user.get_full_name }}</td>
                    <td style="padding: 1rem; color: #64748b;">{{ voter.user.email }}</td>
                    <td style="padding: 1rem; color: #0f172a;">{{ voter.course }}</td>
                    <td style="padding: 1rem; color: #0f172a;">{{ voter.year_level }}</td>
                    <td style="padding: 1rem;">
                        {% if voter.is_eligible_to_vote %}
                        <span
                            style="padding: 0.25rem 0.75rem; background: #dcfce7; color: #166534; border-radius: 12px; font-size: 0.875rem; font-weight: 500;">
                            <i class="fas fa-check-circle"></i> Eligible
                        </span>
                        {% else %}
                        <span
                            style="padding: 0.25rem 0.75rem; background: #fee2e2; color: #991b1b; border-radius: 12px; font-size: 0.875rem; font-weight: 500;">
                            <i class="fas fa-times-circle"></i> Not Eligible
                        </span>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem; color: #0f172a; font-weight: 600;">
                        {{ voter.votes.count }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="padding: 3rem; text-align: center; color: #64748b;">
                        <i class="fas fa-users"
                            style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem; display: block;"></i>
                        No voters registered yet.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    // Search functionality
    document.getElementById('searchInput').addEventListener('keyup', filterTable);
    document.getElementById('filterCourse').addEventListener('change', filterTable);
    document.getElementById('filterYear').addEventListener('change', filterTable);

    function filterTable() {
        const searchValue = document.getElementById('searchInput').value.toLowerCase();
        const courseValue = document.getElementById('filterCourse').value;
        const yearValue = document.getElementById('filterYear').value;
        const rows = document.querySelectorAll('.voter-row');

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            const course = row.dataset.course;
            const year = row.dataset.year;

            const matchesSearch = text.includes(searchValue);
            const matchesCourse = !courseValue || course === courseValue;
            const matchesYear = !yearValue || year === yearValue;

            if (matchesSearch && matchesCourse && matchesYear) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    // Add hover effect
    document.querySelectorAll('.voter-row').forEach(row => {
        row.addEventListener('mouseenter', function () {
            this.style.background = '#f8fafc';
        });
        row.addEventListener('mouseleave', function () {
            this.style.background = '';
        });
    });
</script>
{% endblock %}