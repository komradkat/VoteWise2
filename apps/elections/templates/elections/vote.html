{% extends 'base.html' %}
{% load static %}

{% block title %}Vote - {{ election.name }}{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'elections/css/voting.css' %}">
{% endblock %}

{% block content %}
<div class="voting-container">
    <div class="voting-header">
        <h1>Cast Your Vote</h1>
        <div class="election-title">{{ election.name }}</div>
        <div class="election-info">
            <span><i class="fas fa-calendar"></i> {{ election.start_time|date:"M d, Y" }} - {{ election.end_time|date:"M d, Y" }}</span>
            <span><i class="fas fa-users"></i> {{ positions.count }} Position(s)</span>
        </div>
    </div>

    {% csrf_token %}

    {% for position in positions %}
    <div class="position-section" data-position-id="{{ position.id }}"
        data-max-winners="{{ position.number_of_winners }}">
        <div class="position-header">
            <h2>{{ position.name }}</h2>
            {% if position.description %}
            <p class="position-description">{{ position.description }}</p>
            {% endif %}
            <div class="selection-info">
                <i class="fas fa-info-circle"></i>
                Select {% if position.number_of_winners > 1 %}up to {{ position.number_of_winners }} candidates{% else
                %}1 candidate{% endif %}
            </div>
        </div>

        <div class="candidates-grid">
            {% for candidate in position.candidates.all %}
            <div class="candidate-card" data-candidate-id="{{ candidate.id }}" data-position-id="{{ position.id }}">
                <div class="selection-checkbox">
                    <i class="fas fa-check"></i>
                </div>

                {% if candidate.photo %}
                <img src="{{ candidate.photo.url }}" alt="{{ candidate.student_profile.user.get_full_name }}"
                    class="candidate-photo">
                {% else %}
                <div class="candidate-photo"
                    style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #e0e7ff, #f8fafc);">
                    <i class="fas fa-user" style="font-size: 4rem; color: #cbd5e1;"></i>
                </div>
                {% endif %}

                <div class="candidate-info">
                    <div class="candidate-name">{{ candidate.student_profile.user.get_full_name }}</div>
                    {% if candidate.partylist %}
                    <div class="candidate-partylist">{{ candidate.partylist.short_code }}</div>
                    {% endif %}
                    {% if candidate.biography %}
                    <div class="candidate-bio">{{ candidate.biography }}</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <div class="submit-section">
        <div class="vote-summary">
            <h3>Your Selections</h3>
            <p><span class="selected-count">0</span> candidate(s) selected</p>
        </div>
        <button type="button" class="submit-button" disabled>
            <i class="fas fa-check-circle"></i>
            Submit My Vote
        </button>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <i class="fas fa-vote-yea"></i>
            <h2>Confirm Your Vote</h2>
            <p>Please review your selections before submitting</p>
        </div>

        <div class="modal-selections">
            <!-- Populated by JavaScript -->
        </div>

        <div class="modal-actions">
            <button type="button" class="modal-button cancel">
                <i class="fas fa-times"></i> Cancel
            </button>
            <button type="button" class="modal-button confirm">
                <i class="fas fa-check"></i> Confirm Vote
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'elections/js/voting.js' %}"></script>
{% endblock %}