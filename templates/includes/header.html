{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/includes/header.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

<header>
    <!-- Top Bar: Logo and Auth -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-content">
                <div class="logo-container">
                    <a href="{% url 'home' %}" class="logo">
                        <img src="{% static 'img/logo.png' %}" alt="VoteWise Logo" class="logo-img">
                        <div class="logo-info">
                            <span class="logo-text">ACLC College of Tacloban</span>
                            <a href="https://www.google.com/maps?q=11.238286010439372,125.0042121335158" target="_blank"
                                rel="noopener noreferrer" class="school-address" title="View on Google Maps">
                                <i class="fas fa-map-marker-alt"></i>352 Real St. Tacloban City 6500 Tacloban City,
                                Philippines
                            </a>
                            <p class="system-subtitle">VoteWise - Automated Election System</p>
                        </div>
                    </a>
                </div>
                <div class="vote-button-container">
                    <div class="auth-buttons">
                        {% if user.is_authenticated %}
                        <button onclick="openLogoutModal()" class="btn-secondary logout-btn">
                            <i class="fas fa-sign-out-alt"></i>Log Out
                        </button>
                        {% else %}
                        <a href="{% url 'accounts:login' %}" class="cta-button primary">
                            <i class="fas fa-vote-yea"></i>Log In</a>
                        {% endif %}
                    </div>
                </div>
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <span><i class="fas fa-bars"></i></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Navigation Bar -->
    <div class="main-nav">
        <div class="container">
            <ul class="nav-links" id="navLinks">
                {% if user.is_authenticated %}
                <!-- Authenticated User Navigation -->
                <li><a href="{% url 'accounts:profile' %}"
                        class="{% if request.path == '/auth/profile/' %}active-link{% endif %}">Dashboard</a>
                </li>
                <li><a href="{% url 'elections:list' %}"
                        class="{% if 'elections' in request.path %}active-link{% endif %}">Elections</a></li>
                <li><a href="{% url 'results' %}"
                        class="{% if 'results' in request.path %}active-link{% endif %}">Results</a></li>
                <li><a href="{% url 'about' %}"
                        class="{% if request.path == '/about/' %}active-link{% endif %}">About</a></li>
                {% else %}
                <!-- Unauthenticated User Navigation -->
                <li><a href="{% url 'home' %}" class="{% if request.path == '/' %}active-link{% endif %}">Home</a></li>
                <li><a href="{% url 'results' %}"
                        class="{% if 'results' in request.path %}active-link{% endif %}">Results</a></li>
                <li><a href="#timeline" class="{% if 'timeline' in request.path %}active-link{% endif %}">Timeline</a>
                </li>
                <li><a href="{% url 'about' %}"
                        class="{% if request.path == '/about/' %}active-link{% endif %}">About</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</header>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="modal">
    <div class="modal-content">
        <h2>Confirm Logout</h2>
        <p>Are you sure you want to log out?</p>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeLogoutModal()">Cancel</button>
            <a href="{% url 'accounts:logout' %}" class="btn-confirm">Log Out</a>
        </div>
    </div>
</div>

<script>
    // Profile dropdown toggle
    document.addEventListener('DOMContentLoaded', function () {
        const profileDropdown = document.querySelector('.profile-dropdown');
        if (profileDropdown) {
            const profileTrigger = profileDropdown.querySelector('.profile-trigger');

            profileTrigger.addEventListener('click', function (e) {
                e.preventDefault();
                profileDropdown.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function (e) {
                if (!profileDropdown.contains(e.target)) {
                    profileDropdown.classList.remove('active');
                }
            });

            // Handle dropdown link clicks for hash navigation
            const dropdownLinks = profileDropdown.querySelectorAll('.dropdown-link[href*="#"]');
            dropdownLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    if (href.includes('#')) {
                        const hash = href.split('#')[1];
                        // If we're already on the profile page, just update the hash
                        if (hash && window.location.pathname.includes('/auth/profile/')) {
                            e.preventDefault();
                            window.location.hash = hash;
                            profileDropdown.classList.remove('active');
                        }
                    }
                });
            });
        }
    });

    function openLogoutModal() {
        document.getElementById('logoutModal').style.display = 'block';
    }

    function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
    }

    // Close modal if user clicks outside of it
    window.onclick = function (event) {
        var modal = document.getElementById('logoutModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>